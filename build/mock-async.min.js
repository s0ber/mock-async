/*! mock-async (v0.1.2),
 Simple one-method library for mocking asynchronous methods,
 by Sergey Shishkalov <sergeyshishkalov@gmail.com>, Alex Chrome <dify.chrome@gmail.com>
 Wed Dec 23 2015 */
(function(){var t;t={},null==window.modula&&(window.modula={"export":function(e,i){return t[e]=i},require:function(e){var i;if(i=t[e])return i;throw"Module '"+e+"' not found."}})}).call(this),function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}},o=[].slice;window.mockAsync=function(e,i){return new t(e,i)},e=function(){function t(t,e){this.MockApi=t,this.params=null!=e?e:{},this.shouldReturn=i(this.shouldReturn,this),this.shouldFail=i(this.shouldFail,this),this.shouldSucceed=i(this.shouldSucceed,this),this.whenCalledWith=i(this.whenCalledWith,this)}return t.prototype.whenCalledWith=function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],new t(this.MockApi,_.assign({},this.params,{args:e}))},t.prototype.shouldSucceed=function(t){var e;return e=_.assign({},this.params,{success:!0,value:t}),this.MockApi._addCondition(e),this.MockApi},t.prototype.shouldFail=function(t){var e;return e=_.assign({},this.params,{success:!1,value:t}),this.MockApi._addCondition(e),this.MockApi},t.prototype.shouldReturn=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.shouldSucceed.apply(this,t)},t}(),t=function(){function t(t,o){var s,n,r,u;this.object=t,this.methodName=o,this._mockedMethod=i(this._mockedMethod,this),this.callResults={},s=new e(this),u=e.prototype;for(r in u)n=u[r],this[r]=s[r];this._mockMehod()}return t.prototype.defaultParams={success:!0},t.prototype.restore=function(){return this.prevMethodFn?this.object[this.methodName]=this.prevMethodFn:void 0},t.prototype._addCondition=function(t){return this.callResults[this._getUniqIdForArgs(t.args)]=t,void 0},t.prototype._mockMehod=function(){return this.prevMethodFn=this.object[this.methodName],this.object[this.methodName]=this._mockedMethod},t.prototype._mockedMethod=function(){var t,e,i,s;return t=1<=arguments.length?o.call(arguments,0):[],i=this.callResults[this._getUniqIdForArgs(t)]||this.callResults["default"]||this.defaultParams,s=_.isFunction(null!=i?i.value:void 0)?i.value():null!=i?i.value:void 0,e=new $.Deferred,i.success?e.resolve(s):e.reject(s)},t.prototype._getUniqIdForArgs=function(t){var e,i,o,s;if(!(t&&t.length>0))return"default";for(i="",o=0,s=t.length;s>o;o++)e=t[o],_.isObject(e)?i+=JSON.stringify(e):_.isString(e)&&(i+=e);return i},t}(),modula["export"]("mock_api",t)}.call(this);